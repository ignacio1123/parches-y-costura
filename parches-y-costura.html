<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Parches y Costura</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="styles.css" />
	</head>
	<body>
		<div class="page">
			<header class="topbar">
				<div>
					<p class="eyebrow">Control de Parches</p>
					<h1>Parches y Costura</h1>
				</div>
				<div class="top-actions">
					<label class="btn btn-secondary" for="pdfInput" data-tooltip="Sube un PDF para importar autom√°ticamente los datos del pedido">Cargar PDF</label>
					<input id="pdfInput" type="file" accept="application/pdf" hidden />
					<button id="seedOrdersBtn" class="btn btn-ghost" data-tooltip="Agrega 12 pedidos de prueba para revisar la paginacion">Agregar Pruebas</button>
					<button id="exportBtn" class="btn btn-ghost" data-tooltip="Guarda una copia de seguridad de todos los pedidos en tu computador">Descargar Respaldo</button>
					<label class="btn btn-ghost" for="importInput" data-tooltip="Recupera pedidos desde una copia de seguridad guardada anteriormente">Cargar Respaldo</label>
					<input id="importInput" type="file" accept="application/json" hidden />
				</div>
			</header>

			<section class="cards">
				<article class="card tone-blue">
					<p>Total pedidos</p>
					<h2 id="totalPedidos">0</h2>
				</article>
				<article class="card tone-mint">
					<p>Valor total</p>
					<h2 id="valorTotal">$0</h2>
				</article>
				<article class="card tone-amber">
					<p>Pendiente / En curso</p>
					<h2 id="valorPendiente">$0</h2>
				</article>
				<article class="card tone-emerald">
					<p>Entregado</p>
					<h2 id="valorEntregado">$0</h2>
				</article>
			</section>

			<section class="table-block">
				<div class="section-head">
					<h2>Pedidos Realizados</h2>
					<div class="search-actions">
						<input type="text" id="searchInput" placeholder="Buscar por cliente, fecha, regi√≥n, estado, rango..." class="search-input" />
						<div class="actions-menu">
							<button id="menuBtn" class="btn btn-ghost menu-btn" title="M√°s opciones">‚ãÆ</button>
							<div id="menuDropdown" class="menu-dropdown">
								<button id="descargarFormatoBtn" class="menu-item">üìÑ Descargar Formato</button>
								<button id="exportPdfBtn" class="menu-item">üìä Descargar Reporte</button>
								<button id="addBtn" class="menu-item btn-primary-text">‚ûï Agregar Pedido</button>
							</div>
						</div>
						<select id="formatoPdf" class="select-formato-table" hidden>
							<option value="tienda">Formato Tienda</option>
							<option value="individual">Formato Individual</option>
						</select>
					</div>
				</div>

				<div class="table-wrap">
					<table>
						<thead>
							<tr>
								<th>#</th>
								<th>Fecha</th>
								<th>Cliente</th>
								<th>Rango</th>
								<th>Region/Comuna</th>
								<th>Enviar a</th>
								<th>Cantidad</th>
								<th>Unitario</th>
								<th>Descuento</th>
								<th>Total</th>
								<th>Estado</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody id="ordersBody"></tbody>
					</table>
				</div>
				<div id="pagination" class="pagination" aria-label="Paginacion de pedidos"></div>
			</section>
		</div>

		<div id="modal" class="modal" aria-hidden="true">
			<div class="modal-card" role="dialog" aria-modal="true">
				<header class="modal-head">
					<h3 id="modalTitle">Agregar Pedido</h3>
					<button id="closeModal" class="icon-btn" aria-label="Cerrar">x</button>
				</header>

				<form id="orderForm" class="modal-form">
					<input type="hidden" id="orderId" />

					<div class="form-grid">
						<label>
							Fecha
							<input type="date" id="fecha" required />
						</label>
						<label>
							Nombre Cliente
							<input type="text" id="cliente" required />
						</label>
						<label>
							Tipo de Cliente
							<select id="tipoCliente" required>
								<option value="">Seleccione un tipo</option>
								<option value="individual">Individual</option>
								<option value="tienda">Tienda/Distribuidor</option>
							</select>
						</label>
						<label id="rangoLabel" style="display: none;">
							Rango
							<select id="rango">
								<option value="">Seleccione un rango</option>
								<option value="Carabinero">Carabinero</option>
								<option value="Cabo Segundo">Cabo Segundo</option>
								<option value="Cabo Primero">Cabo Primero</option>
								<option value="Cabo">Cabo</option>
								<option value="Sargento Segundo">Sargento Segundo</option>
								<option value="Sargento Primero">Sargento Primero</option>
								<option value="Suboficial">Suboficial</option>
								<option value="Suboficial Mayor">Suboficial Mayor</option>
								<option value="Subteniente">Subteniente</option>
								<option value="Teniente">Teniente</option>
								<option value="Capit√°n">Capit√°n</option>
								<option value="Mayor">Mayor</option>
								<option value="Teniente Coronel">Teniente Coronel</option>
								<option value="Coronel">Coronel</option>
								<option value="General">General</option>
							</select>
						</label>
						<label>
							Region/Comuna
							<input type="text" id="region" placeholder="Ponga Una Region/Comuna" required />
						</label>
					<label>
						Enviar a
						<textarea id="enviarA" rows="2" class="auto-grow"></textarea>
					</label>
					<label>
						Facturar a
						<textarea id="facturarA" rows="2" class="auto-grow"></textarea>
					</label>
					<label>
						Distribuidor
						<textarea id="distribuidor" rows="2" class="auto-grow"></textarea>
					</label>
					<label class="full">
						Productos (PDF)
						<textarea id="productos" rows="2" class="auto-grow"></textarea>
						</label>
						<label>
							Cantidad
							<input type="number" id="cantidad" min="1" value="1" required />
						</label>
						<label>
							Valor Unitario (CLP)
							<input type="number" id="unitario" min="0" step="1" value="0" required />
						</label>
						<label>
							Descuento (%)
							<input type="number" id="descuento" min="0" max="100" step="1" value="0" />
						</label>
						<label>
							Subtotal (CLP)
							<input type="number" id="subtotal" min="0" step="1" value="0" readonly />
						</label>
						<label>
							Impuestos (CLP)
							<input type="number" id="impuestos" min="0" step="1" value="0" />
						</label>
						<label>
							Envio (CLP)
							<input type="number" id="envio" min="0" step="1" value="0" />
						</label>
						<label>
							Estado
							<select id="estado" required>
								<option value="Pendiente">Pendiente</option>
								<option value="En curso">En curso</option>
								<option value="Entregado">Entregado</option>
								<option value="Confirmado">Confirmado</option>
							</select>
						</label>
						<label>
							Condicion de pago
							<input type="text" id="condicionPago" value="Ninguna" readonly />
						</label>
						<label>
							Moneda del distribuidor
							<input type="text" id="moneda" value="CLP" readonly />
						</label>
						<label>
							Llegada estimada
							<input type="date" id="llegadaEstimada" />
						</label>
					<label class="full">
						Notas
						<textarea id="notas" rows="3" class="auto-grow"></textarea>
					</label>
				</div>

					<div class="total-preview">
						<span>Total calculado</span>
						<strong id="totalPreview">$0</strong>
					</div>

					<footer class="modal-actions">
						<button type="button" id="cancelBtn" class="btn btn-ghost">
							Cancelar
						</button>
						<button type="submit" class="btn btn-primary">Guardar Pedido</button>
					</footer>
				</form>
			</div>
		</div>

		<div id="reportModal" class="modal" aria-hidden="true">
			<div class="modal-card report-modal" role="dialog" aria-modal="true">
				<header class="modal-head">
					<h3>Selecciona registros para el reporte</h3>
					<button id="closeReportModal" class="icon-btn" aria-label="Cerrar">x</button>
				</header>
				<div class="modal-form report-modal-form">
					<!-- B√∫squeda -->
					<div class="report-search-section">
						<input 
							type="text" 
							id="reportSearchInput" 
							placeholder="Buscar por cliente, fecha, regi√≥n, estado, rango..." 
							class="search-input"
						/>
					</div>

					<!-- Selecci√≥n de registros -->
					<div class="report-records-section">
						<div class="report-records-header">
							<h4>Registros (<span id="recordsCount">0</span>):</h4>
							<label class="mark-all-label">
								<input type="checkbox" id="markAllCheckbox"> Marcar todo
							</label>
						</div>
						<div class="report-records-list" id="reportRecordsList">
							<!-- Se genera din√°micamente -->
						</div>
					</div>
				</div>
				<footer class="modal-actions">
					<button type="button" id="cancelReportBtn" class="btn btn-ghost">Cancelar</button>
					<button type="button" id="downloadReportBtn" class="btn btn-primary">Descargar Reporte</button>
				</footer>
			</div>
		</div>

		<div id="confirmModal" class="modal" aria-hidden="true">
			<div class="confirm-card" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
				<header class="modal-head">
					<h3 id="confirmTitle">Confirmar eliminacion</h3>
					<button id="confirmClose" class="icon-btn" aria-label="Cerrar">x</button>
				</header>
				<div class="confirm-body">
					<p id="confirmMessage"></p>
				</div>
				<footer class="modal-actions confirm-actions">
					<button type="button" id="confirmCancel" class="btn btn-ghost">Cancelar</button>
					<button type="button" id="confirmDelete" class="btn btn-primary">Eliminar</button>
				</footer>
			</div>
		</div>

		<!-- Modal para seleccionar formato -->
		<div id="formatModal" class="modal" style="display: none;">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Seleccionar Formato</h3>
					<button type="button" class="close-modal" onclick="document.getElementById('formatModal').style.display = 'none';">‚úï</button>
				</div>
				<div class="modal-body">
					<p>¬øQu√© tipo de formato deseas descargar?</p>
					<div class="format-buttons">
						<button id="formatTiendaBtn" class="btn btn-primary">üè™ Formato Tienda</button>
						<button id="formatIndividualBtn" class="btn btn-secondary">üë§ Formato Individual</button>
					</div>
				</div>
			</div>
		</div>

		<div id="undoToast" class="undo-toast" aria-live="polite">
			<span id="undoMessage"></span>
			<button type="button" id="undoBtn" class="btn btn-ghost btn-sm">Deshacer</button>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
		<script src="app.js"></script>
	</body>
</html>
